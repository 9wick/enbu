# ECサイトE2Eテストフロー
# ポート3060を使用（example/ecサーバー専用ポート）
# テスト用HTTPサーバー（localhost:3060）が起動していることを前提とする
#
# テストシナリオ:
#   1. 商品一覧の表示確認
#   2. 商品検索機能のテスト
#   3. 商品詳細ページへの遷移
#   4. ログイン機能のテスト
#   5. カートへの商品追加
#   6. カート内容の確認・数量変更
#   7. チェックアウト（購入完了）フロー

env:
  BASE_URL: http://localhost:3060

steps:
  # ========================================
  # シナリオ1: 商品一覧の表示確認
  # ========================================

  # ステップ1: トップページを開く
  - open: ${BASE_URL}

  # ステップ2: ページタイトル「オンラインショップ」の表示確認
  - assertVisible: オンラインショップ

  # ステップ3: 「商品一覧」見出しの表示確認
  - assertVisible: 商品一覧

  # ステップ4: 商品が表示されていることを確認（代表的な商品名）
  - assertVisible: プレミアムコーヒー豆 500g

  # ステップ5: 別の商品も表示されていることを確認
  - assertVisible: 有機緑茶ティーバッグ 30包

  # ========================================
  # シナリオ2: 商品検索機能のテスト
  # ========================================

  # ステップ6: 検索ボックスに「はちみつ」と入力
  - fill:
      selector: 商品を検索
      value: はちみつ

  # ステップ7: 検索ボタンをクリック
  - click: 検索

  # ステップ8: 検索結果に「はちみつ」商品が表示されることを確認
  - assertVisible: 北海道産はちみつ 300g

  # ステップ9: トップページに戻る（再読み込み）
  - open: ${BASE_URL}

  # ========================================
  # シナリオ3: 商品詳細ページへの遷移
  # ========================================

  # ステップ10: 商品の「詳細を見る」ボタンをクリック
  - click: 詳細を見る

  # ステップ11: 商品詳細ページの表示確認
  - assertVisible: プレミアムコーヒー豆 500g

  # ステップ12: 商品説明が表示されていることを確認
  - assertVisible: エチオピア産の高品質アラビカ種

  # ステップ13: 価格が表示されていることを確認
  - assertVisible: ¥2,980

  # ステップ14: 在庫情報が表示されていることを確認
  - assertVisible: 在庫

  # ========================================
  # シナリオ4: ログイン機能のテスト
  # ========================================

  # ステップ15: ログインページへ移動
  - open: ${BASE_URL}/login.html

  # ステップ16: ログインフォームの表示確認
  - assertVisible: ログイン

  # ステップ17: テスト用アカウント情報の表示確認
  - assertVisible: テスト用アカウント

  # ステップ18: メールアドレスを入力
  - fill:
      selector: メールアドレス
      value: test@example.com

  # ステップ19: パスワードを入力
  - fill:
      selector: パスワード
      value: password123

  # ステップ20: ログインボタンをクリック
  - click: ログイン

  # ステップ21: ログイン成功メッセージの表示確認
  - assertVisible: ようこそ

  # ステップ22: ログイン成功後、自動リダイレクトを待機
  - wait:
      text: 商品一覧

  # ========================================
  # シナリオ5: カートへの商品追加
  # ========================================

  # ステップ23: ユーザー名が表示されていることを確認（ログイン状態）
  - assertVisible: 山田太郎

  # ステップ24: 商品をカートに追加
  - click: カートに追加

  # ステップ25: カート追加完了のトースト表示確認
  - assertVisible: カートに追加しました

  # ステップ26: 少し待機（UIが更新されるのを待つ）
  - wait: 500

  # ステップ27: カート数が更新されていることを確認
  - assertVisible: (1)

  # ========================================
  # シナリオ6: カート内容の確認
  # ========================================

  # ステップ28: カートページへ移動
  - click: カート

  # ステップ29: カートページの表示確認
  - assertVisible: ショッピングカート

  # ステップ30: カートに商品が入っていることを確認
  - assertVisible: プレミアムコーヒー豆 500g

  # ステップ31: 注文概要が表示されていることを確認
  - assertVisible: 注文概要

  # ステップ32: 合計金額が表示されていることを確認
  - assertVisible: 合計

  # ステップ33: 数量を増やすボタンをクリック（+ボタン）
  - click: +

  # ステップ34: 数量更新のトースト表示確認
  - assertVisible: 数量を更新しました

  # ========================================
  # シナリオ7: チェックアウト（購入完了）フロー
  # ========================================

  # ステップ35: レジに進むボタンをクリック
  - click: レジに進む

  # ステップ36: チェックアウトページの表示確認
  - assertVisible: お支払い情報入力

  # ステップ37: お届け先情報セクションの確認
  - assertVisible: お届け先情報

  # ステップ38: 名前が自動入力されていることを確認
  - assertVisible: 山田太郎

  # ステップ39: 郵便番号を入力
  - fill:
      selector: 郵便番号
      value: 123-4567

  # ステップ40: 住所を入力
  - fill:
      selector: 住所
      value: 東京都渋谷区テスト町1-2-3

  # ステップ41: 電話番号を入力
  - fill:
      selector: 電話番号
      value: 090-1234-5678

  # ステップ42: 支払い方法を選択
  - select:
      selector: 支払い方法
      value: credit

  # ステップ43: 注文内容が表示されていることを確認
  - assertVisible: 注文内容

  # ステップ44: 注文確定ボタンをクリック
  - click: 注文を確定する

  # ステップ45: 注文完了ページの表示確認
  - assertVisible: ご注文ありがとうございます

  # ステップ46: 注文番号が表示されていることを確認
  - assertVisible: 注文番号

  # ステップ47: トップページに戻るリンクの確認
  - assertVisible: トップページに戻る

  # ========================================
  # テスト完了
  # ========================================
